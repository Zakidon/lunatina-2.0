---
import Head from '../../components/Head.astro';
import { getCollection } from 'astro:content';
import QuoteRotator from '../../components/ui/QuoteRotator.astro';
import ThemeToggle from '../../components/ui/ThemeToggle.astro';

export const prerender = false;

const { slug } = Astro.params;
const posts = await getCollection('blog');
const post = posts.find(p => p.slug === slug);

if (!post) {
  return Astro.redirect('/404');
}

const { Content } = await post.render();
const { title, date, rubric } = post.data;
---

<!DOCTYPE html>
<html lang="ru">
 <Head title={`${title} — Лунатина`} />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 font-sans" data-rubric={rubric || 'default'}>
    <header class="container mx-auto px-4 py-6 flex items-center">
       <a href="/" class="shrink-0">
        <img src="/sunmanD.svg" class="w-10 h-10 md:w-12 md:h-12 dark:hidden" alt="Лунатина" />
        <img src="/sunmanW.svg" class="w-10 h-10 md:w-12 md:h-12 hidden dark:block" alt="Лунатina" />
      </a>
      <div class="flex-1 px-6 text-center">
        <QuoteRotator />
      </div>
      <ThemeToggle />
    </header>

    <main class="container mx-auto px-4 py-12 max-w-3xl">
      <article>
        <header class="mb-8">
          <h1 class="text-3xl font-bold">{title}</h1>
          {date && (
            <time class="block mt-2 text-gray-600 dark:text-gray-400">
              {new Date(date).toLocaleDateString('ru-RU', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </time>
          )}
          {rubric && (
            <div class="mt-3 inline-block px-3 py-1 text-sm font-medium bg-amber-50 dark:bg-amber-900 text-amber-800 dark:text-amber-50 rounded-full">
              {rubric}
            </div>
          )}
        </header>
        <div class="prose prose-lg dark:prose-invert max-w-none">
          <Content />
        </div>
      </article>
    </main>

    <footer class="py-6 text-center text-gray-500 text-sm border-t border-gray-200 dark:border-gray-800">
      © {new Date().getFullYear()} Лунатина
    </footer>
  </body>
</html>

<style>
  body[data-rubric="о-нас"] { @apply bg-amber-100 text-gray-800; }
  body[data-rubric="о-нас"].dark { @apply bg-amber-900 text-amber-50; }

  body[data-rubric="нейросети"] { @apply bg-slate-900 text-cyan-300; }
  body[data-rubric="нейросети"].dark { @apply bg-slate-900 text-cyan-300; }

  body[data-rubric="психология"] { @apply bg-purple-100 text-purple-800; }
  body[data-rubric="психология"].dark { @apply bg-purple-900 text-purple-200; }
</style>